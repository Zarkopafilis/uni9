MICRO

c Bootstrap
m00 00000 000 000 111 000 011 pcpc pcpc 00 0111010111
m01 00000 000 000 000 000 001 0000 0000 00 0010000000

c LOADBR #K
m02 00000 000 000 101 000 011 xxxx pcpc 01 0111011110
m03 00000 000 000 111 000 011 xxxx brbr 00 0110011101
c NEXTINSTR
m04 00000 000 000 101 000 011 xxxx pcpc 01 0111011110
m05 00000 000 000 000 000 001 0000 0000 00 0010000000

c LOADSP #K
m06 00000 000 000 101 000 011 xxxx pcpc 01 0111011110
m07 00000 000 000 111 000 011 xxxx spsp 00 0110011101
c NEXTINSTR
m08 00000 000 000 101 000 011 xxxx pcpc 01 0111011110
m09 00000 000 000 000 000 001 0000 0000 00 0010000000

c LOADLR #K
m0a 00000 000 000 101 000 011 xxxx pcpc 01 0111011110
m0b 00000 000 000 111 000 011 xxxx lrlr 00 0110011101
c NEXTINSTR
m0c 00000 000 000 101 000 011 xxxx pcpc 01 0111011110
m0d 00000 000 000 000 000 001 0000 0000 00 0010000000

c PUSH $K 
m0e 00000 000 000 101 000 011 xxxx pcpc 01 0111011110 //K at MDR 
m0f m14 00000 000 000 101 001 011 1010 1010 00 0110111011 //cmp sp, lr fixme
m10 //jump lower if neq 
c NEXTINSTR
m11 00000 000 000 101 000 011 xxxx pcpc 01 0111011110
m12 00000 000 000 000 000 001 0000 0000 00 0010000000

c ACTUAL PUSH 
m13 00000 000 000 101 000 011 spsp spsp 01 0110111110 //inc sp
m14 00000 000 000 101 000 011 spsp spsp 00 0011011101 // NOP, SP -> MAR fixme 
m15 00000 000 000 101 000 011 1001 1001 00 0010111011 //MDR -> MWE~ fixme
c NEXTINSTR
m16 00000 000 000 101 000 011 xxxx pcpc 01 0111011110
m17 00000 000 000 000 000 001 0000 0000 00 0010000000

c POP $K 
m19 //cmp sp, br
m1a //jump lower if neq 
c NEXTINSTR
m1b 00000 000 000 101 000 011 xxxx pcpc 01 0111011110
m1c 00000 000 000 000 000 001 0000 0000 00 0010000000

c ACTUAL POP 
m1d 00000 000 000 101 000 011 xxxx spsp 01 0111011110 //top of stack at MDR 
m1e 00000 000 000 111 000 011 xxxx bbbb 00 0110011101
m1f 00000 000 000 101 000 011 xxxx pcpc 01 0111011110 //K at MDR 
m20 // NOP, SP -> MAR
m21 00000 000 000 101 000 011 bbbb bbbb 00 0010111011 // B -> MWE~ fixme 
m22 00000 000 000 101 000 011 spsp spsp 01 0110111110 // dec SP fixme
c NEXTINSTR
m23 00000 000 000 101 000 011 xxxx pcpc 01 0111011110
m24 00000 000 000 000 000 001 0000 0000 00 0010000000

c ADD 
m24 //cmp sp - 2, br
m25 //jump lower if neq 
c NEXTINSTR
m26 00000 000 000 101 000 011 xxxx pcpc 01 0111011110
m27 00000 000 000 000 000 001 0000 0000 00 0010000000

c ACTUAL ADD 
m28 00000 000 000 101 000 011 xxxx spsp 01 0111011110 //top of stack at MDR 
m29 00000 000 000 111 000 011 xxxx bbbb 00 0110011101 //save to b
m2a 00000 000 000 101 000 011 spsp spsp 01 0110111110 //dec SP fixme
m2b 00000 000 000 101 000 011 xxxx spsp 01 0111011110 //new top of stack at MDR 
m2c // NOP, SP -> MAR
m2d // B + mdr -> MWE~
c NEXTINSTR
m2e 00000 000 000 101 000 011 xxxx pcpc 01 0111011110
m2f 00000 000 000 000 000 001 0000 0000 00 0010000000

c SUB 

MAPPER

c LOADBR
m00 02
c LOADSP 
m01 06
c LOADLR 
m02 0a
c PUSH
m03 0e
c POP
m04 19
c ADD
m05 25
c SUB
m06 

MAIN

c LOADBR $STACKSTART
m00 00
m01 $stackstart 
c LOADSP $stackstart 
m02 01
m03 $stackstart 
c LOADLR 3
m04 02
m05 03

c PUSH
m06 03
m07 $x

c PUSH 
m08 03
m09 $y

c PUSH 
m0a 03 
m0b $z

c ADD 
m0c 05
c SUB 
m0d 06
c POP 
m0e 04
m0f $w